# name: CI Pipeline SuperPokerdex

# on:
#   push:
#     branches:
#       - main
#   pull_request:
#     branches:
#       - main

# jobs:
#   build:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4

#     - name: Set up Python
#       uses: actions/setup-python@v5
#       with:
#         python-version: '3.11'

#     - name: Install dependencies
#       run: |
#         python -m pip install --upgrade pip
#         pip install -r requirements.txt
#         pip install flake8
    
#     - name: Install autopep8
#       run: pip install autopep8

#     - name: Run Flake8 linter
#       run: |
#         flake8 .

#     - name: Build Docker image
#       run: |
#         docker build -t superpokerdex:latest .

#     - name: Install Trivy
#       run: |
#         sudo apt-get install wget apt-transport-https gnupg lsb-release
#         wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
#         echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee -a /etc/apt/sources.list.d/trivy.list
#         sudo apt-get update
#         sudo apt-get install trivy

#     - name: Scan Docker image with Trivy
#       run: |
#         trivy image superpokerdex:latest

#     - name: Build Python package (.whl)
#       run: |
#         python setup.py bdist_wheel

#     - name: Upload wheel artifact
#       uses: actions/upload-artifact@v4
#       with:
#         name: python-package
#         path: dist/*.whl

name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # Bloc Lint
  lint_code:
    name: Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - run: pip install flake8
      - run: flake8 .
  
  # Bloc Tests
  unit_tests:
    name: Unit Tests ‚úÖ
    runs-on: ubuntu-latest
    needs: [lint_code]
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - run: pip install -r requirements.txt
      - run: pip install pytest 
      - run: pytest

  # Bloc Code Security
  sonarcloud_check:
    name: SonarCloud üîç
    runs-on: ubuntu-latest
    needs: [unit_tests]
    steps:
      - uses: actions/checkout@v3
      - name: SonarCloud Scan
        uses: sonarsource/sonarcloud-github-action@v2
        with:
          # configure ton token et projectKey ici
          projectBaseDir: .
  
  trivy_scan:
    name: Trivy Scan üõ°
    runs-on: ubuntu-latest
    needs: [unit_tests]
    steps:
      - uses: aquasecurity/trivy-action@master
        with:
          image-ref: your-docker-image:latest
  
  # Bloc Package
  docker_build:
    name: Docker Build üê≥
    runs-on: ubuntu-latest
    needs: [sonarcloud_check, trivy_scan]
    steps:
      - uses: actions/checkout@v3
      - run: docker build -t your-image-name .
  
  npm_pack:
    name: NPM Pack üì¶
    runs-on: ubuntu-latest
    needs: [sonarcloud_check, trivy_scan]
    steps:
      - uses: actions/checkout@v3
      - run: npm install
      - run: npm pack
